<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>H+ 后台主题UI框架 - 树形视图</title>
    <meta name="keywords" content="H+后台主题,后台bootstrap框架,会员中心主题,后台HTML,响应式后台">
    <meta name="description" content="H+是一个完全响应式，基于Bootstrap3最新版本开发的扁平化主题，她采用了主流的左右两栏式布局，使用了Html5+CSS3等现代技术">

    <link rel="shortcut icon" href="favicon.ico"> 
    <link href="../../css/bootstrap.min14ed.css?v=3.3.6" rel="stylesheet">
    <link href="../../css/font-awesome.min.css?v=4.4.0" rel="stylesheet">
    <link href="../../css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
    <link href="../../css/animate.min.css" rel="stylesheet">
    <link href="../../css/style.min862f.css?v=4.1.0" rel="stylesheet">
    <link href="../../css/plugins/treeview/bootstrap-treeview.css" rel="stylesheet">
    <link href="../../css/pagination.css" rel="stylesheet" />
    <link href="../../css/department.css" rel="stylesheet" />
    <link href="../../css/plugins/toastr/toastr.min.css" rel="stylesheet">
    <link href="../../css/plugins/jsTree/style.min.css" rel="stylesheet">
</head>

<body class="gray-bg">
    <div class="row wrapper wrapper-content animated fadeInRight" id="department">
        <div class="col-sm-12 form-inline ty-query-header">
            <div class="ibox float-e-margins form-group">
                <input type="text" placeholder="查找成员或者部门" v-model="keywords" class="form-control">
                <span class="btn btn-success" @click="department.query_init()">查询</span>
                <span class="btn btn-outline btn-success">清空</span>
            </div>
        </div>
        <div class="ty-content">
            <div class="ty-lay-250">
                <div class="ibox float-e-margins">
                   <!--  <department-menu 
                        :data="menuList"
                        @refresh="refreshList"></department-menu>  -->
                    <div id="treeview11" class="class-active"></div>
                </div>
            </div>
            <div class="ty-lay--250">
                <div class="top-btn">
                    <span class="btn btn-w-m btn-success" data-toggle="modal" data-target="#myModal">添加用户</span>
                    <span class="btn btn-outline btn-success">批量修改部门</span>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th>全选<input type="checkbox"></th>
                                <th>序号</th>
                                <th>姓名</th>
                                <th>警号</th>
                                <th>身份证号码</th>
                                <th>手机号码</th>
                                <th>所在部门</th>
                                <th>邮箱</th>
                                <th>IP地址</th>
                                <th>状态</th>
                                <th>备注</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="checkbox" value=""></td>
                                <td>序号</td>
                                <td>姓名</td>
                                <td>警号</td>
                                <td>身份证号码</td>
                                <td>手机号码</td>
                                <td>所在部门</td>
                                <td>邮箱</td>
                                <td>IP地址</td>
                                <td>状态</td>
                                <td>备注</td>
                                <td>操作</td>
                            </tr>
                            <tr>
                                <td><input type="checkbox" value=""></td>
                                <td>序号</td>
                                <td>姓名</td>
                                <td>警号</td>
                                <td>身份证号码</td>
                                <td>手机号码</td>
                                <td>所在部门</td>
                                <td>邮箱</td>
                                <td>IP地址</td>
                                <td>状态</td>
                                <td>备注</td>
                                <td>操作</td>
                            </tr>
                            <tr>
                            <td><input type="checkbox" value=""></td>
                                <td>序号</td>
                                <td>姓名</td>
                                <td>警号</td>
                                <td>身份证号码</td>
                                <td>手机号码</td>
                                <td>所在部门</td>
                                <td>邮箱</td>
                                <td>IP地址</td>
                                <td>状态</td>
                                <td>备注</td>
                                <td>操作</td>
                            </tr>
                            <tr>
                            <td><input type="checkbox" value=""></td>
                                <td>序号</td>
                                <td>姓名</td>
                                <td>警号</td>
                                <td>身份证号码</td>
                                <td>手机号码</td>
                                <td>所在部门</td>
                                <td>邮箱</td>
                                <td>IP地址</td>
                                <td>状态</td>
                                <td>备注</td>
                                <td>操作</td>
                            </tr>
                            <tr>
                                <td><input type="checkbox" value=""></td>
                                <td>序号</td>
                                <td>姓名</td>
                                <td>警号</td>
                                <td>身份证号码</td>
                                <td>手机号码</td>
                                <td>所在部门</td>
                                <td>邮箱</td>
                                <td>IP地址</td>
                                <td>状态</td>
                                <td>备注</td>
                                <td>操作</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 批量修改部门 -->
        <div class="department">
            <div id="department-tree"></div>
            <div>
                <span class="btn btn-success" @click="department.get_select_node()">查询</span>
                <span class="btn btn-outline btn-success">取消</span>
            </div>
        </div>
    </div>

    <!--  添加用户 -->
    <div class="modal inmodal" id="myModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content animated bounceInRight">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span>
                    </button>
                    <h4 class="modal-title">添加用户</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="col-sm-3">用户名：</label> 
                            <input class="col-sm-8" type="text" placeholder="请输入" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3">身份证号码：</label> 
                            <input class="col-sm-8" type="text" placeholder="请输入"  class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3">警号：</label> 
                            <input class="col-sm-8" type="text" placeholder="请输入"  class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3">所在部门：</label>
                            <input class="col-sm-8" type="text" placeholder="请输入"  class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3">IP地址：</label> 
                            <input class="col-sm-8" type="text" placeholder="请输入"  class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3">手机号码：</label> 
                            <input class="col-sm-8" type="text" placeholder="请输入"  class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3">邮箱：</label> 
                            <input class="col-sm-8" type="text" placeholder="请输入"  class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3">用户状态：</label> 
                            <input type="radio" name="radio" value="radio" checked="checked">启用
                            <input type="radio" name="radio" value="radio">禁用
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3">身份证号码：</label> 
                            <textarea  class="col-sm-8" type="text" placeholder="请输入"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-primary" onclick="add_uer()">保存</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    

    <div id="pageSplit" class="m-style"></div>
    <script src="../../js/jquery.min.js?v=2.1.4"></script>
    <script src="../../js/bootstrap.min.js?v=3.3.6"></script>
    <script src="../../js/content.min.js?v=1.0.0"></script>
    <script src="../../js/plugins/sweetalert/sweetalert.min.js"></script>
    <script src="../../js/jquery.pagination.js"></script>
    <script src="../../js/plugins/toastr/toastr.min.js"></script>
    <script src="../../js/ajax.js"></script>
    <script src="../../js/vue.min.js"></script>
    <script src="../../components/system/index.js"></script>
    <script src="../../js/plugins/jsTree/jstree.min.js"></script>

    <!-- <script src="../../js/plugins/treeview/bootstrap-treeview.js"></script> -->
    <!-- <script src="../../js/demo/treeview-demo.min.js"></script> -->
    <script>
        var department = new Vue({
            el: '#department',
            data () {
                return {
                    keywords: '',
                    ajaxCache: {},
                }
            },
            methods: {
                query_init: function(){
                    this.table_reinit({
                        refresh: 1,
                        data: this.keywords
                    });
                },
                tree_init: function(){
                    var e = [{
                            text: '1231231',
                            id: '1'
                        },{
                            text: 'as6d1a56',
                            id: '2'
                        },{
                            text: '第三發',
                            id: '3',
                            child: [
                                {
                                    text: '子節點1',
                                    id: '4'
                                },{
                                    text: '子節點2',
                                    id: '5'
                                }
                            ]
                        }];
                    this.refresh_tree(e);
                },
                refresh_tree: function(e){
                    var str = this.dom(e),
                        height = str.split("node-tree-item").length - 1;
                    $("#treeview11").css("height",height*32);
                    $("#treeview11").append(str);
                    this.addEvent();
                },
                dom: function(e, index){
                    var icon = '<span class="glyphicon glyphicon-stop"></span><span class="fa fa-ellipsis-v"></span>',
                        show = '<span class="glyphicon glyphicon-plus"></span>';
                    let ind = index || 0,str = e.map(item => {
                        if(item.child && item.child.length){
                            return `<div class="node-tree-item node-tree-ind${ind || ''}" id="node-${item.id}">
                                ${show}${icon}<span class="node-content">${item.text}</span>
                                ${this.dom(item.child, ind+1)}
                            </div>`
                        }else{
                            return  `<div class="node-tree-item node-tree-ind${ind || ''}" id="node-${item.id}">${icon}<span class="node-content">${item.text}</span></div>`
                        }
                    });
                    return str.join('');
                },
                addEvent: function(){
                    var coporation_str = `<div class="coporation-btn-list">
                            <p value="1">修改部門名稱</p>
                            <p value="2" >添加子部門名稱</p>
                            <p value="3">刪除</p>
                            <p value="4">上移</p>
                            <p value="5">下移</p>
                        </div>
                        <div class="default-backmood"></div>`,
                        _this = this;

                    $("#treeview11 *").unbind("click");
                    $("#treeview11").on("click","*",function(){
                        if($(this).hasClass('glyphicon-plus')){
                            $(this).addClass("glyphicon-minus").removeClass("glyphicon-plus");
                            $(this).parent().addClass("class-active");
                            return false;
                        }else if($(this).hasClass('glyphicon-minus')){
                            $(this).addClass("glyphicon-plus").removeClass("glyphicon-minus");
                            $(this).parent().removeClass("class-active");
                            return false;
                        }else if($(this).hasClass('fa-ellipsis-v')){
                            var depart_id = $(this).parent().attr("id").split("node-")[1];
                            $(this).parent().append(coporation_str);
                            _this.department_control(depart_id);
                            return false;
                        }else if($(this).hasClass('node-tree-ind4')){
                            $(".node-tree-item.active").removeClass("active");
                            $(this).addClass("active");
                            return false;
                        }else if($(this).hasClass('node-tree-ind3')){
                            $(".node-tree-item.active").removeClass("active");
                            $(this).addClass("active");
                            return false;
                        }else if($(this).hasClass('node-tree-ind2')){
                            $(".node-tree-item.active").removeClass("active");
                            $(this).addClass("active");
                            return false;
                        }else if($(this).hasClass('node-tree-ind1')){
                            $(".node-tree-item.active").removeClass("active");
                            $(this).addClass("active");
                            return false;
                        }else if($(this).hasClass('node-tree-ind')){
                            $(".node-tree-item.active").removeClass("active");
                            $(this).addClass("active");
                            return false;
                        }
                    })
                },
                department_control: function(id){
                    var _this = this;
                    $(".default-backmood").on("click",function(){
                        this.close_department();
                    });
                    $(".coporation-btn-list>p").on("click",function() {
                        var type = $(this).attr("value");
                        if(type == 1){
                            console.log("修改部門名稱");
                        }else if(type == 2){
                            console.log("添加子部門名稱");
                        }else if(type == 3){
                            swal({
                                title: "您确定要删除該部門么？",
                                text: "删除后将无法恢复，请谨慎操作！",
                                type: "warning",
                                showCancelButton: true,
                                confirmButtonColor: "#DD6B55",
                                confirmButtonText: "删除",
                                closeOnConfirm: false
                            }, function () {
                                swal("删除成功！", "您已经永久删除了該部門信息。", "success");
                                _this.close_department();
                            });
                        }else if(type == 4){
                            console.log("上移");
                        }else if(type == 5){
                            console.log("下移");
                        }
                    })
                },
                close_department: function(){
                    $(".coporation-btn-list").remove();
                    $(".default-backmood").remove();
                },
                table_reinit: function(param){
                    let { refresh, data } = param;
                    this.ajaxCache = Object.assign({},this.ajaxCache,{
                        pageNow: this.pageNow,
                        pageSize: this.pageSize,
                        searchkey: data
                    });  
                    console.log(this.ajaxCache);
                    $.ajax({
                        url: CONNNECT('查询列表接口'),
                        type: 'get',
                        data: this.ajaxCache,
                        success: function(e){
                            if(e.result.length === 0){
                                toastr.warning("没有您查询的相关数据,如有问题,请换一个条件试试！");
                            }else{
                                var str = '';
                                e.result.map((item,index) => {
                                    return `<tr id="${item.id}">
                                        <td><input type="checkbox" value=""></td>
                                        <td>${index+pageSize*(pageNow-1)+1}</td>
                                        <td>${item.name}</td>
                                        <td>${item.policeId}</td>
                                        <td>${item.idcard}</td>
                                        <td>${item.phone}</td>
                                        <td>${item.deaprtment}</td>
                                        <td>${item.email}</td>
                                        <td>${item.ip}</td>
                                        <td>${item.status}</td>
                                        <td>${item.remark}</td>
                                        <td><span>编辑</span><span>重置密码</span></td>
                                    </tr>`
                                }) 
                                $("table tbody").empty().append(str);
                                if(!!refresh){
                                    this.refresh_pagenation();
                                }
                            }
                        }
                    })
                },
                refresh_pagenation: function(){
                    let _this = this;
                    $('#pageSplit').pagination({
                        pageCount: 50,
                        jump: true,
                        coping: true,
                        homePage: '首页',
                        endPage: '末页',
                        prevContent: '上页',
                        nextContent: '下页',
                        callback: function (api) {
                            pageNow = api.getCurrent();
                            this.pageNow = pageNow;
                            _this.table_reinit();
                        }
                    });
                },
                tree_department_select_init: function(){
                    $('#department-tree').jstree({ 
                        'core' : {
                            'data' : [
                                {
                                    'text': '部门1',
                                },{
                                    'text' : '部门2',
                                    'children' : [
                                        { 
                                            'text': '部门2.1' 
                                        },{
                                            'text': '部门2.2'
                                        }
                                    ]
                                }
                            ]
                        },
                        "plugins" : [ "wholerow", "checkbox" ]
                    });
                },
                get_select_node: function(){
                    var ref = $('#department-tree').jstree(true);   //获得整个树
                    var sel = ref.get_selected(false);              //获得所有选中节点，返回值为数组
                    console.log(sel);
                }
            },
            mounted: function(){
                this.tree_init();
                this.query_init();
                this.tree_department_select_init()
            }
        })

        // function treeInit(){
        //     var e = [
        //         {
        //             text: '1231231',
        //             id: '1'
        //         },{
        //             text: 'as6d1a56',
        //             id: '2'
        //         },{
        //             text: '第三發',
        //             id: '3',
        //             child: [
        //                 {
        //                     text: '子節點1',
        //                     id: '4'
        //                 },{
        //                     text: '子節點2',
        //                     id: '5'
        //                 }
        //             ]
        //         }
        //     ];
        //     refresh_tree();
           
        //    // 菜单dom组成逻辑代码
        //     function dom(e, index){
        //         var icon = '<span class="glyphicon glyphicon-stop"></span><span class="fa fa-ellipsis-v"></span>',
        //             show = '<span class="glyphicon glyphicon-plus"></span>';
        //         let ind = index || 0,str = e.map(item => {
        //             if(item.child && item.child.length){
        //                 return `<div class="node-tree-item node-tree-ind${ind || ''}" id="node-${item.id}">
        //                     ${show}${icon}<span class="node-content">${item.text}</span>
        //                     ${dom(item.child, ind+1)}
        //                 </div>`
        //             }else{
        //                 return  `<div class="node-tree-item node-tree-ind${ind || ''}" id="node-${item.id}">${icon}<span class="node-content">${item.text}</span></div>`
        //             }
        //         });
        //         return str.join('');
        //     }

        //     //  刷新菜单
        //     function refresh_tree(){
        //         var str = dom(e),
        //             height = str.split("node-tree-item").length - 1;
        //         $("#treeview11").css("height",height*32);
        //         $("#treeview11").append(str);
        //         addEvent();
        //     }

        //     // 菜单控制
        //     function addEvent(){
        //         var coporation_str = `<div class="coporation-btn-list">
        //             <p value="1">修改部門名稱</p>
        //             <p value="2" >添加子部門名稱</p>
        //             <p value="3">刪除</p>
        //             <p value="4">上移</p>
        //             <p value="5">下移</p>
        //         </div>
        //         <div class="default-backmood"></div>`;

        //         $("#treeview11 *").unbind("click");
        //         $("#treeview11").on("click","*",function(){
        //             if($(this).hasClass('glyphicon-plus')){
        //                 $(this).addClass("glyphicon-minus").removeClass("glyphicon-plus");
        //                 $(this).parent().addClass("class-active");
        //                 return false;
        //             }else if($(this).hasClass('glyphicon-minus')){
        //                 $(this).addClass("glyphicon-plus").removeClass("glyphicon-minus");
        //                 $(this).parent().removeClass("class-active");
        //                 return false;
        //             }else if($(this).hasClass('fa-ellipsis-v')){
        //                 var depart_id = $(this).parent().attr("id").split("node-")[1];
        //                 $(this).parent().append(coporation_str);
        //                 department_control(depart_id);
        //                 return false;
        //             }else if($(this).hasClass('node-tree-ind4')){
        //                 $(".node-tree-item.active").removeClass("active");
        //                 $(this).addClass("active");
        //                 return false;
        //             }else if($(this).hasClass('node-tree-ind3')){
        //                 $(".node-tree-item.active").removeClass("active");
        //                 $(this).addClass("active");
        //                 return false;
        //             }else if($(this).hasClass('node-tree-ind2')){
        //                 $(".node-tree-item.active").removeClass("active");
        //                 $(this).addClass("active");
        //                 return false;
        //             }else if($(this).hasClass('node-tree-ind1')){
        //                 $(".node-tree-item.active").removeClass("active");
        //                 $(this).addClass("active");
        //                 return false;
        //             }else if($(this).hasClass('node-tree-ind')){
        //                 $(".node-tree-item.active").removeClass("active");
        //                 $(this).addClass("active");
        //                 return false;
        //             }
        //         });
        //     }

        //     //  部门控制
        //     function department_control(id){
        //         $(".default-backmood").on("click",function(){
        //             close_department();
        //         });
        //         $(".coporation-btn-list>p").on("click",function() {
        //             var type = $(this).attr("value");
        //             if(type == 1){
        //                 console.log("修改部門名稱");
        //             }else if(type == 2){
        //                 console.log("添加子部門名稱");
        //             }else if(type == 3){
        //                 swal({
        //                     title: "您确定要删除該部門么？",
        //                     text: "删除后将无法恢复，请谨慎操作！",
        //                     type: "warning",
        //                     showCancelButton: true,
        //                     confirmButtonColor: "#DD6B55",
        //                     confirmButtonText: "删除",
        //                     closeOnConfirm: false
        //                 }, function () {
        //                     swal("删除成功！", "您已经永久删除了該部門信息。", "success");
        //                     close_department();
        //                 });
        //             }else if(type == 4){
        //                 console.log("上移");
        //             }else if(type == 5){
        //                 console.log("下移");
        //             }
        //         })
        //     }

        //     // 关闭部门控制窗口
        //     function close_department(){
        //         $(".coporation-btn-list").remove();
        //         $(".default-backmood").remove();
        //     }
        // }

        // function table_reinit(param){
        //     let { refresh, data } = param;
        //     ajaxCache = Object.assign({},ajaxCache,{
        //         pageNow: pageNow,
        //         pageSize: pageSize,
        //         searchkey: data
        //     })  //  这里可能有问题
        //     $.ajax({
        //         url: CONNNECT('查询列表接口'),
        //         type: 'get',
        //         data: ajaxCache,
        //         success: function(e){
        //             if(e.result.length === 0){
        //                 toastr.warning("没有您查询的相关数据,如有问题,请换一个条件试试！");
        //             }else{
        //                 var str = '';
        //                 e.result.map((item,index) => {
        //                     return `<tr id="${item.id}">
        //                         <td><input type="checkbox" value=""></td>
        //                         <td>${index+pageSize*(pageNow-1)+1}</td>
        //                         <td>${item.name}</td>
        //                         <td>${item.policeId}</td>
        //                         <td>${item.idcard}</td>
        //                         <td>${item.phone}</td>
        //                         <td>${item.deaprtment}</td>
        //                         <td>${item.email}</td>
        //                         <td>${item.ip}</td>
        //                         <td>${item.status}</td>
        //                         <td>${item.remark}</td>
        //                         <td><span>编辑</span><span>重置密码</span></td>
        //                     </tr>`
        //                 }) 
        //                 $("table tbody").empty().append(str);
        //                 if(!!refresh){
        //                     refresh_pagenation();
        //                 }
        //             }
        //         }
        //     })
        // }

        // function refresh_pagenation(){
        //     $('#pageSplit').pagination({
        //         pageCount: 50,
        //         jump: true,
        //         coping: true,
        //         homePage: '首页',
        //         endPage: '末页',
        //         prevContent: '上页',
        //         nextContent: '下页',
        //         callback: function (api) {
        //             console.log(api.getCurrent())
        //             pageNow = api.getCurrent();
        //             table_reinit();
        //         }
        //     });
        // }

        // //  添加子部门
        // function add_uer(){
        //     alert("OK");
        // }

    </script>
</body>
</html>
